<style>
    body, table, td, th, div, h1, h2, h3, h4, h5, h6, caption, strong {
        font-family: 'TH Sarabun', sans-serif;
        font-size: 14pt;
    }
    table.table-bordered {
        border-collapse: collapse;
        width: 100%;
        margin-top: 10px;
    }
    table.table-bordered th, table.table-bordered td {
        border: 1px solid #000;
        padding: 5px;
    }
    td[style*="text-align:right"], th[style*="text-align:right"] {
        text-align: right;
    }
    thead.table_header {
        display: table-header-group;
        background-color: #f5f5f5;
    }
    caption {
        font-weight: bold;
        margin-bottom: 5px;
        text-align: left;
    }
</style>

{# ------------------- table 1 : each line from Payment Entry Reference -------------------- #}
{# -------- only pay OR receive -------- #}
{% if doc.payment_type != 'Internal Transfer' %} 
<table class="table table-bordered table-condensed">
    <caption><strong>แต่ละรายการจาก Payment Entry Reference</strong></caption>
    <thead class="repeat table_header">
    <tr>
        <th>ลำดับ</th>
        <th>เลขที่เอกสาร</th>
        <th>เอกสารอ้างอิง</th>
        <th>วันครบกำหนด</th>
        <th>สกุลเงิน</th>
        <th>ยอดค้างชำระ</th>
        <th>ยอดจัดสรร</th>
    </tr>
    </thead>
    {% set outsumm = [0] %}
    {% set asumm = [0] %}
    {% for item in doc.references | sort(attribute='reference_name') %}
    <tr>
        <td>{{ loop.index }}</td>
        <td>{{ item.reference_name }}</td>
        <td>{{ item.bill_no }}</td>
        <td>{{ frappe.utils.format_date(item.due_date, "dd/mm/yyyy") }}</td>
        <td>{{ doc.paid_to_account_currency }} ({{ item.conversion_rate }})</td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(item.outstanding_amount, format='Thai') }}</td>
        <td style="text-align:right">{{ frappe.utils.fmt_money(item.allocated_amount, format='Thai') }}</td>
    </tr>
    {% if asumm.append(asumm[-1] + item.allocated_amount) %}{% endif %}
    {% if outsumm.append(outsumm[-1] + item.outstanding_amount) %}{% endif %}
    {% endfor %}
    <tr>
        <td></td>
        <td style="text-align:right"><strong>รวม</strong></td>
        <td></td> <td></td> <td></td>
        <td style="text-align:right"><strong>{{ frappe.utils.fmt_money(outsumm[-1], format='Thai') }}</strong></td>
        <td style="text-align:right"><strong>{{ frappe.utils.fmt_money(asumm[-1], format='Thai') }}</strong></td>
    </tr>
</table>
{% endif %}